import{T as K,E as W,a as h,I as p,C as Q,g as X,f as $,V as j,i as q,b as S,c as ee,d as T,e as N,h as A,m as te,t as re,j as ne,k as oe,l as C,n as ie,o as se,P as ae,p as ce,q as le,s as ue,u as de,B as ge,M as he}from"./mapContainer-cb3be453.js";import"./compat.module-b1a3416f.js";import{F as me,a as pe,t as Y,G as ye,L as fe,M as xe,b as we,c as Fe,C as Re,R as Pe,B as Oe,V as Ge,S as _e,d as Ce,e as be,D as Ie}from"./drawingLayer-ee4f469e.js";import{_ as ve,p as je}from"./hooks.module-10a4f742.js";import{o as b}from"./jsxRuntime.module-8e7d8b33.js";import"./preact.module-4f38c496.js";class Le extends K{constructor(e,t,n,i){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=i}changed(){this.dispatchEvent(W.CHANGE)}getExtent(){return this.extent}getImage(){return h()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){h()}}const Ee=Le;class Me extends Ee{constructor(e,t,n,i,o){const s=o!==void 0?p.IDLE:p.LOADED;super(e,t,n,s),this.loader_=o!==void 0?o:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=p.ERROR):this.state=p.LOADED,this.changed()}load(){this.state==p.IDLE&&(this.state=p.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const Se=Me;class Te extends Q{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,i=e.viewState,o=i.resolution,s=this.getLayer().getSource(),a=e.viewHints;let c=e.extent;if(t.extent!==void 0&&(c=X(c,$(t.extent,i.projection))),!a[j.ANIMATING]&&!a[j.INTERACTING]&&!q(c))if(s){const l=i.projection,d=s.getImage(c,o,n,l);d&&(this.loadImage(d)?this.image_=d:d.getState()===p.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),i=S(t.pixelToCoordinateTransform,e.slice()),o=n.getExtent();if(o&&!ee(o,i))return null;const s=this.image_.getExtent(),a=this.getImage(),c=T(s),l=Math.floor(a.width*((i[0]-s[0])/c));if(l<0||l>=a.width)return null;const d=N(s),y=Math.floor(a.height*((s[3]-i[1])/d));return y<0||y>=a.height?null:this.getImageData(a,l,y)}renderFrame(e,t){const n=this.image_,i=n.getExtent(),o=n.getResolution(),s=n.getPixelRatio(),a=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,l=e.viewState,d=l.center,y=l.resolution,G=c*o/(y*s),w=e.extent,R=l.resolution,m=l.rotation,g=Math.round(T(w)/R*c),f=Math.round(N(w)/R*c);A(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,m,-g/2,-f/2),te(this.inversePixelTransform,this.pixelTransform);const x=re(this.pixelTransform);this.useContainer(t,x,this.getBackground(e));const u=this.context,F=u.canvas;F.width!=g||F.height!=f?(F.width=g,F.height=f):this.containerReused||u.clearRect(0,0,g,f);let L=!1,E=!0;if(a.extent){const O=$(a.extent,l.projection);E=ne(O,e.extent),L=E&&!oe(O,e.extent),L&&this.clipUnrotated(u,e,O)}const P=this.getImage(),_=A(this.tempTransform,g/2,f/2,G,G,0,s*(i[0]-d[0])/o,s*(d[1]-i[3])/o);this.renderedResolution=o*c/s;const J=P.width*_[0],V=P.height*_[3];if(this.getLayer().getSource().getInterpolate()||(u.imageSmoothingEnabled=!1),this.preRender(u,e),E&&J>=.5&&V>=.5){const O=_[4],Z=_[5],M=a.opacity;let H;M!==1&&(H=u.globalAlpha,u.globalAlpha=M),u.drawImage(P,0,0,+P.width,+P.height,O,Z,J,V),M!==1&&(u.globalAlpha=H)}return this.postRender(u,e),L&&u.restore(),u.imageSmoothingEnabled=!0,x!==F.style.transform&&(F.style.transform=x),this.container}}const Ne=Te;class Ae extends me{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(I(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(I(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return h()}readFeaturesFromObject(e,t){return h()}readGeometry(e,t){return this.readGeometryFromObject(I(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return h()}readProjection(e){return this.readProjectionFromObject(I(e))}readProjectionFromObject(e){return h()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return h()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return h()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return h()}}function I(r){if(typeof r=="string"){const e=JSON.parse(r);return e||null}return r!==null?r:null}const ke=Ae;class De extends ke{constructor(e){e=e||{},super(),this.dataProjection=C(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=C(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const i=k(n.geometry,t),o=new pe;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&o.setGeometryName(n.geometry_name),o.setGeometry(i),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o}readFeaturesFromObject(e,t){const n=e;let i=null;if(n.type==="FeatureCollection"){const o=e;i=[];const s=o.features;for(let a=0,c=s.length;a<c;++a)i.push(this.readFeatureFromObject(s[a],t))}else i=[this.readFeatureFromObject(e,t)];return i}readGeometryFromObject(e,t){return k(e,t)}readProjectionFromObject(e){const t=e.crs;let n;return t?t.type=="name"?n=C(t.properties.name):t.type==="EPSG"?n=C("EPSG:"+t.properties.code):ie(!1,36):n=this.dataProjection,n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(n.id=i),!e.hasProperties())return n;const o=e.getProperties(),s=e.getGeometry();return s&&(n.geometry=D(s,t),delete o[e.getGeometryName()]),se(o)||(n.properties=o),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,o=e.length;i<o;++i)n.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return D(e,this.adaptOptions(t))}}function k(r,e){if(!r)return null;let t;switch(r.type){case"Point":{t=Ve(r);break}case"LineString":{t=He(r);break}case"Polygon":{t=Ue(r);break}case"MultiPoint":{t=Be(r);break}case"MultiLineString":{t=$e(r);break}case"MultiPolygon":{t=ze(r);break}case"GeometryCollection":{t=Je(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return Y(t,!1,e)}function Je(r,e){const t=r.geometries.map(function(n){return k(n,e)});return new ye(t)}function Ve(r){return new ae(r.coordinates)}function He(r){return new fe(r.coordinates)}function $e(r){return new xe(r.coordinates)}function Be(r){return new we(r.coordinates)}function ze(r){return new Fe(r.coordinates)}function Ue(r){return new ce(r.coordinates)}function D(r,e){r=Y(r,!0,e);const t=r.getType();let n;switch(t){case"Point":{n=Qe(r);break}case"LineString":{n=qe(r);break}case"Polygon":{n=Xe(r,e);break}case"MultiPoint":{n=Ze(r);break}case"MultiLineString":{n=Ye(r);break}case"MultiPolygon":{n=Ke(r,e);break}case"GeometryCollection":{n=We(r,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function We(r,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return D(n,e)})}}function qe(r,e){return{type:"LineString",coordinates:r.getCoordinates()}}function Ye(r,e){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function Ze(r,e){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function Ke(r,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}function Qe(r,e){return{type:"Point",coordinates:r.getCoordinates()}}function Xe(r,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}const et=De;class tt extends Ne{constructor(e){super(e),this.vectorRenderer_=new Re(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=le(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=S(this.coordinateToVectorPixelTransform_,S(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,n=e.viewState,i=n.resolution,o=e.viewHints,s=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),ue(a,this.layerImageRatio_));const c=T(a)/i,l=N(a)/i;if(!o[j.ANIMATING]&&!o[j.INTERACTING]&&!q(a)){s.useContainer(null,null);const d=s.context,y=e.layerStatesArray[e.layerIndex],G=Object.assign({},y,{opacity:1}),w=Object.assign({},e,{declutterTree:new Pe(9),extent:a,size:[c,l],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[G],layerIndex:0});let R=!0;const m=new Se(a,i,t,d.canvas,function(g){s.prepareFrame(w)&&s.replayGroupChanged&&(s.clipping=!1,s.renderFrame(w,null)&&(s.renderDeclutter(w),R=!1),g())});m.addEventListener(W.CHANGE,()=>{if(m.getState()!==p.LOADED)return;this.image_=R?null:m;const g=m.getResolution(),f=m.getPixelRatio(),x=g*t/f;this.renderedResolution=x,this.coordinateToVectorPixelTransform_=A(this.coordinateToVectorPixelTransform_,c/2,l/2,1/x,-1/x,0,-n.center[0],-n.center[1])}),m.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,i,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,i,o):super.forEachFeatureAtCoordinate(e,t,n,i,o)}}const rt=tt;class nt extends Oe{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new rt(this)}}const ot=nt,it=({features:r,stroke:e,fill:t,zIndex:n=1})=>{const i=de(),o=ve(null);return je(()=>{o.current&&(i.removeLayer(o.current),o.current=null);const s=new Ge({features:new et().readFeatures(r)});return o.current=new ot({source:s,style:new _e({fill:new Ce(t),stroke:new be(e)})}),o.current.setZIndex(n),i.addLayer(o.current),()=>{o.current&&(i==null||i.removeLayer(o.current))}},[r,i,o,e,t]),null},st=({features:r,stroke:e,fill:t,zIndex:n})=>b(he,{children:[b(ge,{lat:54.97,lng:-1.627,zoom:15.5,style:{height:"500px",width:"500px"}}),b(it,{features:r,stroke:e,fill:t,zIndex:n}),b(Ie,{})]}),ht={component:st,title:"Components/Map/Map Layer",tags:["autodocs"]},v={args:{stroke:{color:"#003078",width:2},fill:{color:"rgba(0, 48, 120, 0.2)"},features:{type:"FeatureCollection",features:[{geometry:{type:"MultiPolygon",coordinates:[[[[-1.62581,54.969804],[-1.625196,54.96974],[-1.625058,54.970268],[-1.625068,54.970562],[-1.625283,54.970584],[-1.625293,54.970553],[-1.625331,54.97052],[-1.625371,54.9705],[-1.62542,54.970487],[-1.625592,54.970487],[-1.625627,54.970475],[-1.625663,54.970449],[-1.625809,54.969894],[-1.62581,54.969804]]],[[[-1.625786,54.971015],[-1.625776,54.971043],[-1.626438,54.971144],[-1.626601,54.970767],[-1.625944,54.97068],[-1.625793,54.971011],[-1.625786,54.971015]]],[[[-1.625186,54.971047],[-1.625334,54.971068],[-1.625378,54.970951],[-1.62579,54.97101],[-1.625942,54.97068],[-1.625378,54.970602],[-1.62534,54.97067],[-1.625186,54.971047]]],[[[-1.628544,54.970167],[-1.628629,54.969963],[-1.628349,54.969759],[-1.627934,54.969428],[-1.627838,54.969442],[-1.627826,54.969456],[-1.627803,54.969461],[-1.627765,54.969461],[-1.627703,54.969431],[-1.627298,54.969398],[-1.627255,54.969421],[-1.627216,54.969418],[-1.627205,54.969391],[-1.627141,54.969386],[-1.627048,54.969616],[-1.626742,54.969581],[-1.626693,54.969697],[-1.626407,54.969662],[-1.626421,54.969618],[-1.62593,54.96957],[-1.625878,54.969791],[-1.625945,54.969854],[-1.628482,54.970185],[-1.628544,54.970167]]],[[[-1.627112,54.970841],[-1.626924,54.971221],[-1.627029,54.971238],[-1.627015,54.971267],[-1.627088,54.971275],[-1.627097,54.971263],[-1.627085,54.97126],[-1.627099,54.971241],[-1.62713,54.971234],[-1.627715,54.971326],[-1.627899,54.970945],[-1.627478,54.97089],[-1.627112,54.970841]]],[[[-1.626846,54.971211],[-1.627022,54.970824],[-1.626604,54.970767],[-1.626424,54.971187],[-1.626578,54.971208],[-1.626585,54.971191],[-1.62674,54.971212],[-1.626748,54.971194],[-1.626846,54.971211]]],[[[-1.628261,54.970992],[-1.628273,54.970994],[-1.627903,54.970945],[-1.627677,54.97141],[-1.628319,54.971497],[-1.628473,54.9713],[-1.628487,54.971261],[-1.628502,54.971263],[-1.628584,54.971037],[-1.628274,54.970994],[-1.628573,54.971033],[-1.628862,54.971073],[-1.62911,54.970334],[-1.628635,54.970283],[-1.62845,54.970891],[-1.628302,54.970877],[-1.628261,54.970992]]]]},type:"Feature",properties:{}}]}}};var B,z,U;v.parameters={...v.parameters,docs:{...(B=v.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: {
    stroke: {
      color: "#003078",
      width: 2
    },
    fill: {
      color: "rgba(0, 48, 120, 0.2)"
    },
    features: {
      type: "FeatureCollection",
      features: [{
        geometry: {
          type: "MultiPolygon",
          coordinates: [[[[-1.62581, 54.969804], [-1.625196, 54.96974], [-1.625058, 54.970268], [-1.625068, 54.970562], [-1.625283, 54.970584], [-1.625293, 54.970553], [-1.625331, 54.97052], [-1.625371, 54.9705], [-1.62542, 54.970487], [-1.625592, 54.970487], [-1.625627, 54.970475], [-1.625663, 54.970449], [-1.625809, 54.969894], [-1.62581, 54.969804]]], [[[-1.625786, 54.971015], [-1.625776, 54.971043], [-1.626438, 54.971144], [-1.626601, 54.970767], [-1.625944, 54.97068], [-1.625793, 54.971011], [-1.625786, 54.971015]]], [[[-1.625186, 54.971047], [-1.625334, 54.971068], [-1.625378, 54.970951], [-1.62579, 54.97101], [-1.625942, 54.97068], [-1.625378, 54.970602], [-1.62534, 54.97067], [-1.625186, 54.971047]]], [[[-1.628544, 54.970167], [-1.628629, 54.969963], [-1.628349, 54.969759], [-1.627934, 54.969428], [-1.627838, 54.969442], [-1.627826, 54.969456], [-1.627803, 54.969461], [-1.627765, 54.969461], [-1.627703, 54.969431], [-1.627298, 54.969398], [-1.627255, 54.969421], [-1.627216, 54.969418], [-1.627205, 54.969391], [-1.627141, 54.969386], [-1.627048, 54.969616], [-1.626742, 54.969581], [-1.626693, 54.969697], [-1.626407, 54.969662], [-1.626421, 54.969618], [-1.62593, 54.96957], [-1.625878, 54.969791], [-1.625945, 54.969854], [-1.628482, 54.970185], [-1.628544, 54.970167]]], [[[-1.627112, 54.970841], [-1.626924, 54.971221], [-1.627029, 54.971238], [-1.627015, 54.971267], [-1.627088, 54.971275], [-1.627097, 54.971263], [-1.627085, 54.97126], [-1.627099, 54.971241], [-1.62713, 54.971234], [-1.627715, 54.971326], [-1.627899, 54.970945], [-1.627478, 54.97089], [-1.627112, 54.970841]]], [[[-1.626846, 54.971211], [-1.627022, 54.970824], [-1.626604, 54.970767], [-1.626424, 54.971187], [-1.626578, 54.971208], [-1.626585, 54.971191], [-1.62674, 54.971212], [-1.626748, 54.971194], [-1.626846, 54.971211]]], [[[-1.628261, 54.970992], [-1.628273, 54.970994], [-1.627903, 54.970945], [-1.627677, 54.97141], [-1.628319, 54.971497], [-1.628473, 54.9713], [-1.628487, 54.971261], [-1.628502, 54.971263], [-1.628584, 54.971037], [-1.628274, 54.970994], [-1.628573, 54.971033], [-1.628862, 54.971073], [-1.62911, 54.970334], [-1.628635, 54.970283], [-1.62845, 54.970891], [-1.628302, 54.970877], [-1.628261, 54.970992]]]]
        },
        type: "Feature",
        properties: {}
      }]
    }
  }
}`,...(U=(z=v.parameters)==null?void 0:z.docs)==null?void 0:U.source}}};const mt=["Default"];export{v as Default,mt as __namedExportsOrder,ht as default};
//# sourceMappingURL=MapLayer.stories-9b67b1a1.js.map
