import"./compat.module-b1a3416f.js";import{K as W,E as $,N as l,O as y,Q as z,R as q,U as V,W as b,X as H,Y as L,Z as Y,_ as T,$ as N,a0 as S,a1 as Z,a2 as K,i as Q,a3 as X,a4 as p,a5 as ee,m as te,a6 as re,a7 as ne,G as ie,o as oe,L as ae,t as se,q as ce,u as ue,x as le,C as de,a8 as ge,a9 as he,aa as me,a as ye,J as pe,V as fe,ab as xe,ac as Pe,ad as we}from"./MultiPolygon-adcb1022.js";import{_ as Fe,p as Re}from"./hooks.module-10a4f742.js";class je extends W{constructor(e,t,r,o){super(),this.extent=e,this.pixelRatio_=r,this.resolution=t,this.state=o}changed(){this.dispatchEvent($.CHANGE)}getExtent(){return this.extent}getImage(){return l()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){l()}}const Oe=je;class Ge extends Oe{constructor(e,t,r,o,i){const a=i!==void 0?y.IDLE:y.LOADED;super(e,t,r,a),this.loader_=i!==void 0?i:null,this.canvas_=o,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=y.ERROR):this.state=y.LOADED,this.changed()}load(){this.state==y.IDLE&&(this.state=y.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const _e=Ge;class Ie extends z{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,o=e.viewState,i=o.resolution,a=this.getLayer().getSource(),s=e.viewHints;let c=e.extent;if(t.extent!==void 0&&(c=q(c,V(t.extent,o.projection))),!s[b.ANIMATING]&&!s[b.INTERACTING]&&!H(c))if(a){const u=o.projection,d=a.getImage(c,i,r,u);d&&(this.loadImage(d)?this.image_=d:d.getState()===y.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),o=L(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!Y(i,o))return null;const a=this.image_.getExtent(),s=this.getImage(),c=T(a),u=Math.floor(s.width*((o[0]-a[0])/c));if(u<0||u>=s.width)return null;const d=N(a),f=Math.floor(s.height*((a[3]-o[1])/d));return f<0||f>=s.height?null:this.getImageData(s,u,f)}renderFrame(e,t){const r=this.image_,o=r.getExtent(),i=r.getResolution(),a=r.getPixelRatio(),s=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,f=u.resolution,G=c*i/(f*a),w=e.extent,R=u.resolution,m=u.rotation,h=Math.round(T(w)/R*c),x=Math.round(N(w)/R*c);S(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,m,-h/2,-x/2),Z(this.inversePixelTransform,this.pixelTransform);const P=K(this.pixelTransform);this.useContainer(t,P,this.getBackground(e));const g=this.context,F=g.canvas;F.width!=h||F.height!=x?(F.width=h,F.height=x):this.containerReused||g.clearRect(0,0,h,x);let v=!1,C=!0;if(s.extent){const O=V(s.extent,u.projection);C=Q(O,e.extent),v=C&&!X(O,e.extent),v&&this.clipUnrotated(g,e,O)}const j=this.getImage(),_=S(this.tempTransform,h/2,x/2,G,G,0,a*(o[0]-d[0])/i,a*(d[1]-o[3])/i);this.renderedResolution=i*c/a;const k=j.width*_[0],J=j.height*_[3];if(this.getLayer().getSource().getInterpolate()||(g.imageSmoothingEnabled=!1),this.preRender(g,e),C&&k>=.5&&J>=.5){const O=_[4],B=_[5],E=s.opacity;let D;E!==1&&(D=g.globalAlpha,g.globalAlpha=E),g.drawImage(j,0,0,+j.width,+j.height,O,B,k,J),E!==1&&(g.globalAlpha=D)}return this.postRender(g,e),v&&g.restore(),g.imageSmoothingEnabled=!0,P!==F.style.transform&&(F.style.transform=P),this.container}}const be=Ie;class ve{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let r=t.dataProjection?p(t.dataProjection):this.readProjection(e);t.extent&&r&&r.getUnits()==="tile-pixels"&&(r=p(r),r.setWorldExtent(t.extent)),t={dataProjection:r,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return l()}readFeature(e,t){return l()}readFeatures(e,t){return l()}readGeometry(e,t){return l()}readProjection(e){return l()}writeFeature(e,t){return l()}writeFeatures(e,t){return l()}writeGeometry(e,t){return l()}}function U(n,e,t){const r=t?p(t.featureProjection):null,o=t?p(t.dataProjection):null;let i;if(r&&o&&!ee(r,o)?i=(e?n.clone():n).transform(e?r:o,e?o:r):i=n,e&&t&&t.decimals!==void 0){const a=Math.pow(10,t.decimals),s=function(c){for(let u=0,d=c.length;u<d;++u)c[u]=Math.round(c[u]*a)/a;return c};i===n&&(i=n.clone()),i.applyTransform(s)}return i}class Ce extends ve{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(I(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(I(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return l()}readFeaturesFromObject(e,t){return l()}readGeometry(e,t){return this.readGeometryFromObject(I(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return l()}readProjection(e){return this.readProjectionFromObject(I(e))}readProjectionFromObject(e){return l()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return l()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return l()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return l()}}function I(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}const Ee=Ce;class Le extends Ee{constructor(e){e=e||{},super(),this.dataProjection=p(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=p(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let r=null;e.type==="Feature"?r=e:r={type:"Feature",geometry:e,properties:null};const o=M(r.geometry,t),i=new te;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(o),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i}readFeaturesFromObject(e,t){const r=e;let o=null;if(r.type==="FeatureCollection"){const i=e;o=[];const a=i.features;for(let s=0,c=a.length;s<c;++s)o.push(this.readFeatureFromObject(a[s],t))}else o=[this.readFeatureFromObject(e,t)];return o}readGeometryFromObject(e,t){return M(e,t)}readProjectionFromObject(e){const t=e.crs;let r;return t?t.type=="name"?r=p(t.properties.name):t.type==="EPSG"?r=p("EPSG:"+t.properties.code):re(!1,36):r=this.dataProjection,r}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},o=e.getId();if(o!==void 0&&(r.id=o),!e.hasProperties())return r;const i=e.getProperties(),a=e.getGeometry();return a&&(r.geometry=A(a,t),delete i[e.getGeometryName()]),ne(i)||(r.properties=i),r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let o=0,i=e.length;o<i;++o)r.push(this.writeFeatureObject(e[o],t));return{type:"FeatureCollection",features:r}}writeGeometryObject(e,t){return A(e,this.adaptOptions(t))}}function M(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Ne(n);break}case"LineString":{t=Se(n);break}case"Polygon":{t=Je(n);break}case"MultiPoint":{t=Ae(n);break}case"MultiLineString":{t=Me(n);break}case"MultiPolygon":{t=ke(n);break}case"GeometryCollection":{t=Te(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return U(t,!1,e)}function Te(n,e){const t=n.geometries.map(function(r){return M(r,e)});return new ie(t)}function Ne(n){return new oe(n.coordinates)}function Se(n){return new ae(n.coordinates)}function Me(n){return new se(n.coordinates)}function Ae(n){return new ce(n.coordinates)}function ke(n){return new ue(n.coordinates)}function Je(n){return new le(n.coordinates)}function A(n,e){n=U(n,!0,e);const t=n.getType();let r;switch(t){case"Point":{r=Be(n);break}case"LineString":{r=Ve(n);break}case"Polygon":{r=We(n,e);break}case"MultiPoint":{r=He(n);break}case"MultiLineString":{r=$e(n);break}case"MultiPolygon":{r=Ue(n,e);break}case"GeometryCollection":{r=De(n,e);break}case"Circle":{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return r}function De(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(r){return A(r,e)})}}function Ve(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function $e(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function He(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Ue(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Be(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function We(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const ze=Le;class qe extends be{constructor(e){super(e),this.vectorRenderer_=new de(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=ge(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=L(this.coordinateToVectorPixelTransform_,L(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,r=e.viewState,o=r.resolution,i=e.viewHints,a=this.vectorRenderer_;let s=e.extent;this.layerImageRatio_!==1&&(s=s.slice(0),he(s,this.layerImageRatio_));const c=T(s)/o,u=N(s)/o;if(!i[b.ANIMATING]&&!i[b.INTERACTING]&&!H(s)){a.useContainer(null,null);const d=a.context,f=e.layerStatesArray[e.layerIndex],G=Object.assign({},f,{opacity:1}),w=Object.assign({},e,{declutterTree:new me(9),extent:s,size:[c,u],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[G],layerIndex:0});let R=!0;const m=new _e(s,o,t,d.canvas,function(h){a.prepareFrame(w)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(w,null)&&(a.renderDeclutter(w),R=!1),h())});m.addEventListener($.CHANGE,()=>{if(m.getState()!==y.LOADED)return;this.image_=R?null:m;const h=m.getResolution(),x=m.getPixelRatio(),P=h*t/x;this.renderedResolution=P,this.coordinateToVectorPixelTransform_=S(this.coordinateToVectorPixelTransform_,c/2,u/2,1/P,-1/P,0,-r.center[0],-r.center[1])}),m.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,r,o,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,o,i):super.forEachFeatureAtCoordinate(e,t,r,o,i)}}const Ye=qe;class Ze extends ye{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Ye(this)}}const Ke=Ze,tt=({features:n,stroke:e,fill:t,zIndex:r=1})=>{const o=pe(),i=Fe(null);return Re(()=>{i.current&&(o.removeLayer(i.current),i.current=null);const a=new fe({features:new ze().readFeatures(n)});return i.current=new Ke({source:a,style:new xe({fill:new Pe(t),stroke:new we(e)})}),i.current.setZIndex(r),o.addLayer(i.current),()=>{i.current&&(o==null||o.removeLayer(i.current))}},[n,o,i,e,t]),null};export{ve as F,tt as M,U as t};
//# sourceMappingURL=mapLayer-cce135b9.js.map
